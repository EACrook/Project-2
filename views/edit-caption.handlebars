<a href="/">
  <h1 class="animate__animated animate__fadeInBottomLeft {{homeRoastMe}} {{pageRoastMe}} pl-6 roast-me">Roast Me</h1>
</a>

<a href="/login" class="self-end">
  <nav class="animate__animated animate__fadeInBottomRight pr-6 log">Logout</nav>
</a>
</header>

{{!-- {{#form "/posts" class="form"}}
{{label "paragraph" "Tell us about your drink!"}}
{{input "comment" ""}}
{{submit "save" "Post your roast"}}
{{/form}}

<button id="upload_widget" class="cloudinary-button">Upload files</button>

<script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>

<script type="text/javascript">
  var myWidget = cloudinary.createUploadWidget({
    cloudName: 'do24cjpnx',
    uploadPreset: 'ml_default'
  }, (error, result) => {
    if (!error && result && result.event === "success") {
      console.log('Done! Here is the image info: ', result.info);

      console.log('URL to save to the DB!!!', result.info.secure_url)
    }
  }
  )

  document.getElementById("upload_widget").addEventListener("click", function () {
    myWidget.open();
  }, false);
</script> --}}

<p>write your caption</p>
<input id="comment" type="text"> </input>
<button id="upload_widget" class="cloudinary-button">Upload files</button>

<script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>

<script type="text/javascript">
  const makePost = async (photo_url) => {
    const comment = document.querySelector('#comment').value.trim();
    const response = await fetch('/api/posts', {
      method: 'post',
      body: JSON.stringify({comment, photo_url, user_id: '1'}),
      headers: { 'Content-Type': 'application/json' }
    });
    //check for response status
    if (response.ok) {
      alert('it worked')
    } else {
      alert('it didn\'t worked')
    }
  }

  var myWidget = cloudinary.createUploadWidget({
    cloudName: 'do24cjpnx',
    uploadPreset: 'ml_default'
  }, (error, result) => {
    if (!error && result && result.event === "success") {
      console.log('Done! Here is the image info: ', result.info);
      console.log('URL to save to the DB!!!', result.info.secure_url)
      makePost(result.info.secure_url);
    } else if (error) {
      alert('Failed to upload file - ' + error)
    }
  }
  )

  document.getElementById("upload_widget").addEventListener("click", function () {
    myWidget.open();
  }, false);
</script>